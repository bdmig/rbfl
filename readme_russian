rbfl - это простой и эффективный скрипт для регулярных бэкапов при
помощи rsync. Использует rsync, sshfs, cifs-utils, expect.

Скрипт предпочтительно запускать из-под учетной записи root при
помощи cron. Бэкапы создаются на том компьютере, на котором
запускается скрипт.

Описание переменных, которые необходимо заполнить:
$broot - каталог для бэкапов, начиная с корня
$bgrp - группа файловых систем для бэкапа.
Можно объединять бэкапы в группы
(например, "office", "hosting", "office2" и т.п.)

Имена компьютеров и дисков задаются в аргументах функции copy_files.
Функция copy_files принимает 1 аргумент для linux-компьютеров
(имя компьютера) и 2 аргумента для windows-компьютеров
(имя компьютера и буква диска).
Эти аргументы используются в именах скриптов монтирования и файлов
со списками источников.
Скрипты монтирования имеют имена mount_$fpath, где
fpath=$bgrp"_$1" (Linux) или
fpath=$bgrp"_$1_$2" (Windows).

Примеры скриптов монтирования приведены.
Скрипты монтирования по умолчанию находятся в папке /etc/rbfl/mount
Рекомендуется максимально ограничить к ней доступ, так как в скриптах
могут быть пароли.

Если по каким-то причинам источник не смонтирован после попытки
монтирования, в качестве источника задается предыдущий бэкап.

Списки файлов и папок для бэкапа находятся в файлах backup_$fpath,
по умолчанию находящихся в /etc/rbfl
Примеры списков приведены.
Пояснение для масок: одна звездочка означает любое количество
символов или все файлы в каталоге после последнего слеша;
две звездочки означают все файлы и каталоги после последнего слеша,
то есть рекурсию.

Структура папки бэкапов: $broot/$bgrp/$curdate/$bpath,
где $curdate - это дата и время бэкапа в формате +%F--%H-%M.

Место на диске для бэкапов используется очень экономно,
rsync копирует только новые и измененные файлы. Для всех файлов,
не измененных после предыдущего бэкапа, создаются хардлинки.
Все это определяется параметрами запуска rsync.

Для успешной работы скрипта предварительно должны быть созданы
каталог $broot и точка монтирования файловых систем /mnt/rbfl

Скрипт ведет логи бэкапов в папке /var/log/rsync
Кроме того, там же создается файл emergency.log,
в который пишутся ошибки монтирования.
